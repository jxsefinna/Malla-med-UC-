<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Malla Interactiva Medicina UC - Avanzada</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    margin: 0; padding: 20px;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 12px;
    color: #004aad;
  }
  .controls {
    max-width: 900px;
    margin: 0 auto 16px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
  button, select {
    padding: 8px 14px;
    border-radius: 8px;
    border: 1px solid #0f52ba;
    background: white;
    color: #0f52ba;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s;
  }
  button:hover, select:hover {
    background-color: #0f52ba;
    color: white;
  }
  #progressBarContainer {
    max-width: 900px;
    margin: 0 auto 16px;
    background: #ddd;
    border-radius: 12px;
    overflow: hidden;
    height: 20px;
  }
  #progressBar {
    height: 100%;
    width: 0;
    background: #0f52ba;
    transition: width 0.3s ease;
  }
  #progressText {
    max-width: 900px;
    margin: 8px auto 24px;
    text-align: center;
    font-weight: 700;
    color: #0f52ba;
  }

  .grid-malla {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 14px;
    overflow-x: auto;
    padding-bottom: 40px;
  }
  .semestre {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgb(0 0 0 / 0.1);
    padding: 14px;
    display: flex;
    flex-direction: column;
  }
  .semestre h2 {
    font-size: 1.1rem;
    color: #0f52ba;
    margin-bottom: 10px;
    border-bottom: 3px solid #0f52ba;
    padding-bottom: 6px;
    text-align: center;
  }
  .curso {
    background: #d1e0ff;
    margin: 6px 0;
    padding: 12px 14px;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 1px 6px rgb(0 0 0 / 0.1);
    transition: background-color 0.3s ease;
    position: relative;
  }
  .curso:hover {
    background: #a1c3ff;
  }
  .curso.completado {
    background: #a2f5aa;
    color: #2a5d14;
    font-weight: 600;
  }
  .tooltip {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #004aad;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 13px;
    line-height: 20px;
    text-align: center;
    cursor: help;
    font-weight: 700;
  }
  #modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }
  #modalContent {
    background: white;
    border-radius: 12px;
    max-width: 480px;
    width: 90%;
    padding: 24px;
    box-shadow: 0 6px 18px rgb(0 0 0 / 0.3);
    position: relative;
    font-size: 1rem;
  }
  #modalClose {
    position: absolute;
    top: 14px;
    right: 18px;
    font-size: 24px;
    cursor: pointer;
    color: #555;
    user-select: none;
  }
  #btnToggleComplete {
    margin-top: 22px;
    background: #0f52ba;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.25s;
  }
  #btnToggleComplete:hover {
    background: #073b7a;
  }
  @media (max-width: 1024px) {
    .grid-malla {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
  }
</style>
</head>
<body>

<h1>ü©∫ Malla Interactiva Medicina UC</h1>

<div class="controls">
  <select id="filterSelect" title="Filtrar cursos">
    <option value="all">Mostrar todos</option>
    <option value="completed">Solo completados ‚úÖ</option>
    <option value="pending">Solo pendientes ‚è≥</option>
  </select>
  <button id="resetBtn" title="Resetear progreso">üîÑ Resetear progreso</button>
  <button id="exportBtn" title="Exportar progreso JSON">üì§ Exportar progreso</button>
</div>

<div id="progressBarContainer"><div id="progressBar"></div></div>
<div id="progressText">Progreso: 0%</div>

<div class="grid-malla" id="malla"></div>

<!-- Modal -->
<div id="modal">
  <div id="modalContent">
    <span id="modalClose">&times;</span>
    <h3 id="modalTitle"></h3>
    <p id="modalDesc"></p>
    <button id="btnToggleComplete"></button>
  </div>
</div>

<script>
  const mallaData = [
    {
      semestre: 1,
      cursos: [
        { nombre: "Bases y Fundamentos I", descripcion: "Introducci√≥n a la medicina y ciencias b√°sicas.", prereq: [] },
        { nombre: "Qu√≠mica", descripcion: "Curso de qu√≠mica general y org√°nica.", prereq: [] },
        { nombre: "Psicolog√≠a M√©dica", descripcion: "Fundamentos de psicolog√≠a aplicada a la medicina.", prereq: [] },
        { nombre: "F√≠sica", descripcion: "Bases de f√≠sica relevantes para ciencias m√©dicas.", prereq: [] },
        { nombre: "Biolog√≠a Molecular", descripcion: "Estudio de la biolog√≠a a nivel molecular.", prereq: [] },
      ],
    },
    {
      semestre: 2,
      cursos: [
        { nombre: "Bases y Fundamentos II", descripcion: "Continuaci√≥n del estudio b√°sico en medicina.", prereq: ["Bases y Fundamentos I"] },
        { nombre: "Morfolog√≠a I", descripcion: "Anatom√≠a y estructura humana b√°sica.", prereq: [] },
        { nombre: "Bioestad√≠stica", descripcion: "M√©todos estad√≠sticos aplicados a la salud.", prereq: [] },
        { nombre: "Antropolog√≠a y √âtica", descripcion: "Aspectos sociales y √©ticos en medicina.", prereq: [] },
        { nombre: "Formaci√≥n General 1", descripcion: "Cursos optativos y formaci√≥n transversal.", prereq: [] },
      ],
    },
    {
      semestre: 3,
      cursos: [
        { nombre: "Morfolog√≠a II", descripcion: "Anatom√≠a avanzada y t√©cnicas de diagn√≥stico.", prereq: ["Morfolog√≠a I"] },
        { nombre: "Inmunolog√≠a y Gen√©tica", descripcion: "Estudio del sistema inmune y gen√©tica humana.", prereq: [] },
        { nombre: "Razonamiento Matem√°tico", descripcion: "Desarrollo del pensamiento l√≥gico y matem√°tico.", prereq: [] },
        { nombre: "Formaci√≥n General 2", descripcion: "Cursos optativos y formaci√≥n transversal.", prereq: [] },
      ],
    },
    {
      semestre: 4,
      cursos: [
        { nombre: "Morfolog√≠a III", descripcion: "Estudio avanzado de estructuras corporales.", prereq: ["Morfolog√≠a II"] },
        { nombre: "Bases y Mecanismos Enfermedad I", descripcion: "Introducci√≥n a patolog√≠as y mecanismos de enfermedad.", prereq: [] },
        { nombre: "Salud P√∫blica", descripcion: "Principios de salud colectiva y promoci√≥n.", prereq: [] },
        { nombre: "Formaci√≥n General 3", descripcion: "Cursos optativos y formaci√≥n transversal.", prereq: [] },
      ],
    },
    {
      semestre: 5,
      cursos: [
        { nombre: "Cl√≠nica I", descripcion: "Primer contacto cl√≠nico con pacientes.", prereq: ["Bases y Mecanismos Enfermedad I"] },
        { nombre: "Microbiolog√≠a M√©dica", descripcion: "Estudio de microorganismos y su relaci√≥n con la salud.", prereq: [] },
        { nombre: "ICM I", descripcion: "Integrado Ciencias M√©dicas I.", prereq: [] },
        { nombre: "Farmacolog√≠a M√©dica", descripcion: "Principios b√°sicos de medicamentos.", prereq: [] },
      ],
    },
    {
      semestre: 6,
      cursos: [
        { nombre: "Cl√≠nica II", descripcion: "Continuaci√≥n de la formaci√≥n cl√≠nica.", prereq: ["Cl√≠nica I"] },
        { nombre: "Bases de la Pr√°ctica Profesional", descripcion: "Introducci√≥n a la pr√°ctica m√©dica profesional.", prereq: [] },
        { nombre: "ICM II", descripcion: "Integrado Ciencias M√©dicas II.", prereq: [] },
        { nombre: "ICM III", descripcion: "Integrado Ciencias M√©dicas III.", prereq: [] },
      ],
    },
    {
      semestre: 7,
      cursos: [
        { nombre: "Cl√≠nica III", descripcion: "Avanzado en formaci√≥n cl√≠nica.", prereq: ["Cl√≠nica II"] },
        { nombre: "Neurociencias", descripcion: "Estudio del sistema nervioso.", prereq: [] },
        { nombre: "ICM IV", descripcion: "Integrado Ciencias M√©dicas IV.", prereq: [] },
        { nombre: "Formaci√≥n General 4", descripcion: "Cursos optativos y formaci√≥n transversal.", prereq: [] },
      ],
    },
    {
      semestre: 8,
      cursos: [
        { nombre: "Integrado Quir√∫rgico", descripcion: "Formaci√≥n quir√∫rgica integrada.", prereq: [] },
        { nombre: "ICM V", descripcion: "Integrado Ciencias M√©dicas V.", prereq: [] },
        { nombre: "ICM VI", descripcion: "Integrado Ciencias M√©dicas VI.", prereq: [] },
      ],
    },
    {
      semestre: 9,
      cursos: [
        { nombre: "Pediatr√≠a y Cirug√≠a Infantil", descripcion: "Atenci√≥n m√©dica infantil.", prereq: [] },
        { nombre: "Medicina del Adulto", descripcion: "Cl√≠nica en adultos.", prereq: [] },
        { nombre: "Obstetricia y Ginecolog√≠a", descripcion: "Salud de la mujer.", prereq: [] },
      ],
    },
    {
      semestre: 10,
      cursos: [
        { nombre: "Cirug√≠a", descripcion: "Formaci√≥n en t√©cnicas quir√∫rgicas.", prereq: [] },
        { nombre: "Neuropsiquiatr√≠a Cl√≠nica", descripcion: "Psiquiatr√≠a y neurolog√≠a cl√≠nica.", prereq: [] },
        { nombre: "Urgencias", descripcion: "Manejo de urgencias m√©dicas.", prereq: [] },
        { nombre: "Dermatolog√≠a", descripcion: "Estudio de enfermedades de la piel.", prereq: [] },
        { nombre: "Oftalmolog√≠a", descripcion: "Salud visual y enfermedades oculares.", prereq: [] },
        { nombre: "Otorrinolaringolog√≠a", descripcion: "Estudio de o√≠do, nariz y garganta.", prereq: [] },
      ],
    },
    {
      semestre: 11,
      cursos: [
        { nombre: "Internado Medicina Interna", descripcion: "Pr√°ctica cl√≠nica avanzada en medicina interna.", prereq: [] },
        { nombre: "Internado Pediatr√≠a", descripcion: "Pr√°ctica cl√≠nica avanzada en pediatr√≠a.", prereq: [] },
        { nombre: "Internado Obstetricia", descripcion: "Pr√°ctica cl√≠nica avanzada en obstetricia.", prereq: [] },
      ],
    },
    {
      semestre: 12,
      cursos: [
        { nombre: "Medicina Familiar", descripcion: "Pr√°ctica y teor√≠a en medicina familiar.", prereq: [] },
        { nombre: "Internado Electivo", descripcion: "Pr√°ctica electiva en √°rea de inter√©s.", prereq: [] },
        { nombre: "Profundizaci√≥n", descripcion: "Cursos para profundizaci√≥n acad√©mica.", prereq: [] },
      ],
    },
  ];

  const malla = document.getElementById('malla');
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalDesc = document.getElementById('modalDesc');
  const btnToggleComplete = document.getElementById('btnToggleComplete');
  const modalClose = document.getElementById('modalClose');
  const filterSelect = document.getElementById('filterSelect');
  const resetBtn = document.getElementById('resetBtn');
  const exportBtn = document.getElementById('exportBtn');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');

  let currentFilter = 'all';

  function getAllCourses() {
    return mallaData.flatMap(s => s.cursos);
  }

  function countCompleted() {
    return getAllCourses().filter(c => localStorage.getItem(c.nombre) === 'completado').length;
  }

  function updateProgressBar() {
    const total = getAllCourses().length;
    const done = countCompleted();
    const percent = total === 0 ? 0 : Math.round((done / total) * 100);
    progressBar.style.width = percent + '%';
    progressText.textContent = `Progreso: ${percent}% (${done} de ${total})`;
  }

  function renderMalla() {
    malla.innerHTML = '';
    mallaData.forEach(({ semestre, cursos }) => {
      const divSem = document.createElement('div');
      divSem.classList.add('semestre');
      divSem.style.gridColumn = semestre;

      const h2 = document.createElement('h2');
      h2.textContent = `Semestre ${semestre}`;
      divSem.appendChild(h2);

      cursos.forEach(curso => {
        const isCompleted = localStorage.getItem(curso.nombre) === 'completado';

        if (currentFilter === 'completed' && !isCompleted) return;
        if (currentFilter === 'pending' && isCompleted) return;

        const divCurso = document.createElement('div');
        divCurso.classList.add('curso');
        divCurso.textContent = curso.nombre;
        divCurso.dataset.nombre = curso.nombre;

        if (curso.prereq.length > 0) {
          const tooltip = document.createElement('span');
          tooltip.classList.add('tooltip');
          tooltip.title = "Prerrequisitos:\n" + curso.prereq.join('\n');
          tooltip.textContent = "i";
          divCurso.appendChild(tooltip);
        }

        if (isCompleted) {
          divCurso.classList.add('completado');
        }

        divCurso.addEventListener('click', () => openModal(curso));

        divSem.appendChild(divCurso);
      });

      malla.appendChild(divSem);
    });

    updateProgressBar();
  }

  function openModal(curso) {
    modalTitle.textContent = curso.nombre;
    modalDesc.textContent = curso.descripcion;
    const completado = localStorage.getItem(curso.nombre) === 'completado';

    btnToggleComplete.textContent = completado ? 'Marcar como NO completado ‚ùå' : 'Marcar como completado ‚úÖ';
    btnToggleComplete.onclick = () => {
      if (completado) {
        localStorage.removeItem(curso.nombre);
      } else {
        localStorage.setItem(curso.nombre, 'completado');
      }
      renderMalla();
      closeModal();
    };

    modal.style.display = 'flex';
  }

  function closeModal() {
    modal.style.display = 'none';
  }

  modalClose.onclick = closeModal;
  window.onclick = e => {
    if (e.target === modal) closeModal();
  };

  filterSelect.onchange = () => {
    currentFilter = filterSelect.value;
    renderMalla();
  };

  resetBtn.onclick = () => {
    if(confirm("¬øSeguro quieres resetear todo el progreso?")) {
      getAllCourses().forEach(c => localStorage.removeItem(c.nombre));
      renderMalla();
    }
  };

  exportBtn.onclick = () => {
    const completedCourses = getAllCourses()
      .filter(c => localStorage.getItem(c.nombre) === 'completado')
      .map(c => c.nombre);

    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(completedCourses, null, 2));
    const dlAnchorElem = document.createElement('a');
    dlAnchorElem.setAttribute("href", dataStr);
    dlAnchorElem.setAttribute("download", "progreso_malla_med_uc.json");
    document.body.appendChild(dlAnchorElem);
    dlAnchorElem.click();
    dlAnchorElem.remove();
  };

  renderMalla();
</script>

</body>
</html>
